<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>GoRide MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    #map { height: 400px; }
    .form-box { padding: 10px; background:#f4f4f4; }
    input, button { padding:8px; margin:5px 0; width:100%; }
    .result { margin-top:10px; font-weight:bold; }
  </style>
</head>
<body>
  <div class="form-box">
    <form id="orderForm">
      <label>Lokasi Jemput:</label>
      <input type="text" id="pickup" placeholder="Contoh: Monas Jakarta" required>
      <label>Tujuan:</label>
      <input type="text" id="destination" placeholder="Contoh: Plaza Senayan" required>
      <button type="submit">Pesan</button>
    </form>
    <div class="result" id="result"></div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map = L.map('map').setView([-6.200000, 106.816666], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    // Rumus haversine
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // Ambil koordinat dari alamat
    function getCoordinates(address, callback) {
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${address}`)
        .then(res => res.json())
        .then(data => {
          if (data.length > 0) {
            let lat = parseFloat(data[0].lat);
            let lon = parseFloat(data[0].lon);
            callback(lat, lon);
          } else {
            alert("Alamat tidak ditemukan: " + address);
          }
        });
    }

    document.getElementById("orderForm").addEventListener("submit", function(e) {
      e.preventDefault();
      let pickup = document.getElementById("pickup").value;
      let destination = document.getElementById("destination").value;

      getCoordinates(pickup, function(lat1, lon1) {
        getCoordinates(destination, function(lat2, lon2) {
          // Hapus marker lama
          markers.forEach(m => map.removeLayer(m));
          markers = [];

          // Tambah marker jemput
          let m1 = L.marker([lat1, lon1]).addTo(map).bindPopup("Jemput: " + pickup).openPopup();
          markers.push(m1);

          // Tambah marker tujuan
          let m2 = L.marker([lat2, lon2]).addTo(map).bindPopup("Tujuan: " + destination).openPopup();
          markers.push(m2);

          // Fokus peta ke tengah
          let bounds = L.latLngBounds([ [lat1, lon1], [lat2, lon2] ]);
          map.fitBounds(bounds);

          // Hitung jarak
          let distance = getDistance(lat1, lon1, lat2, lon2).toFixed(2);
          let price = 5000 + (distance * 2500);

          document.getElementById("result").innerHTML =
            `Jarak: ${distance} km<br>Harga: Rp${price.toLocaleString()}`;
        });
      });
    });
  </script>
</body>
</html>
